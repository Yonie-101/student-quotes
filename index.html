<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Cozy Corner ‚òïÔ∏è</title>
  <style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #fff8f0;
    color: #4e342e;
    padding: 30px;
    max-width: 900px;
    margin: auto;
  }
  .section {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin-bottom: 40px;
  }
  .column {
    flex: 1;
    background-color: #fff3e0;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  input[type="text"],
  input[type="file"],
  select,
  textarea {
    width: 100%;
    box-sizing: border-box;
    padding: 10px;
    margin-top: 10px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  button {
    height: 42px;
    padding: 0 20px;
    background-color: #a1887f;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    white-space: nowrap;
  }
  button.full-width {
    width: 100%;
  }
  #confessionExpiry {
  height: 42px;
  line-height: 42px;   
  padding: 0 10px;
  border-radius: 6px;
  border: none;
  margin-top: 0;
  background-color: #a1887f;
  color: white;
  font-size: 16px;
  cursor: pointer;
  flex: 1;             
}

  #customFile {
    margin-top: 10px;
  }
  .entry {
    margin-top: 15px;
    padding: 10px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    position: relative;
  }
  .reactions {
    display: flex;
    gap: 8px;
    margin-top: 8px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .entry:hover .reactions {
    opacity: 1;
    pointer-events: auto;
  }
  .reactions span {
    font-size: 20px;
    cursor: pointer;
    opacity: 1;
    transition: transform 0.2s ease, opacity 0.3s ease;
  }
  .reactions span:hover {
    transform: scale(1.2);
  }
  .reactions[data-selected] span:not([data-active]) {
    opacity: 0;
    pointer-events: none;
  }
  .reactions[data-selected]:hover span {
    opacity: 1;
    pointer-events: auto;
  }
  .entry:hover .reaction-circle {
    opacity: 0;
  }
  .reaction-circle {
    position: absolute;
    bottom: -10px;
    left: 10px;
    background: #ffeaa7;
    border-radius: 50%;
    padding: 6px;
    font-size: 14px;
    box-shadow: 0 0 4px rgba(0,0,0,0.1);
    opacity: 1;
    transition: opacity 0.3s ease;
    z-index: 10;
  }
  .top-reacted,
  .minigames,
  .meme-generator {
    margin-bottom: 40px;
  }
  .top-reacted ol {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    padding: 0;
    list-style: none;
  }
  .top-reacted li {
    flex: 1;
    background: #fff3e0;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    position: relative;
    transition: all 0.3s ease;
  }
  .top-reacted li:hover .reaction-counts {
    display: block;
  }
  .reaction-counts {
    display: none;
    position: absolute;
    bottom: 10px;
    right: 10px;
    font-size: 14px;
    background: #ffeaa7;
    padding: 5px 10px;
    border-radius: 8px;
  }
  .emoji-burst {
    position: absolute;
    font-size: 24px;
    animation: floatUp 1s ease-out forwards;
    pointer-events: none;
  }
  @keyframes floatUp {
    0% { opacity: 1; transform: translateY(0) scale(1); }
    50% { transform: translateY(-40px) scale(1.4); }
    100% { opacity: 0; transform: translateY(-80px) scale(0.8); }
  }
  .scrollable-box {
    max-height: 300px;
    overflow-y: auto;
    padding-right: 10px;
  }
  .scrollable-box::-webkit-scrollbar {
    width: 6px;
  }
  .scrollable-box::-webkit-scrollbar-thumb {
    background-color: #a1887f;
    border-radius: 4px;
  }
  .gallery-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    min-height: 120px;
  }
  .gallery-grid img {
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  .gallery-grid img:hover {
    transform: scale(1.05);
  }
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.2);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 999;
    overflow: auto;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .modal[style*="display: flex"] {
    opacity: 1;
  }
  .modal-content {
    position: relative;
    background: #fff8f0;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    max-width: 90%;
    max-height: 90%;
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .close-button,
  .use-image-button {
    background-color: #a1887f;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 16px;
    cursor: pointer;
  }
  #collectionModalHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .modal-content img {
    width: auto;
    max-width: 100%;
    height: auto;
    max-height: 95vh;
    display: block;
    margin: 0 auto;
    border-radius: 12px;
  }
  @media (max-width: 600px) {
    .section {
      flex-direction: column;
    }
    input[type="text"],
    input[type="file"],
    select,
    textarea,
    button {
      font-size: 14px;
    }
  }
  </style>
	
</head>
<body>

  <div class="section">
    <div class="column">
      <h3>Student Quotes</h3>
      <input type="text" id="quoteInput" placeholder="Share a cozy thought..." style="margin-bottom: 10px;" />
<div style="display: flex; gap: 10px;">
  <button onclick="postQuote()">Post Quote</button>
  <button onclick="generateRandomQuote()">üé≤ Random Quote</button>
</div>

  <div id="quoteList" class="scrollable-box"></div>
    </div>
    <div class="column">
      <h3>Hidden Feelings üíï</h3>
      <input type="text" id="crushInput" placeholder="Got a secret crush?" />
      <div style="display: flex; gap: 10px; margin-top: 10px; align-items: center;">
    <select id="confessionExpiry">
    <option value="">‚è≥ Select expiry time</option>
    <option value="0.5">30 seconds</option>
    <option value="5">5 minutes</option>
    <option value="15">15 minutes</option>
    <option value="30">30 minutes</option>
    <option value="60">1 hour</option>
    <option value="300">5 hours</option>
    <option value="1440">1 day</option>
  </select>
  <button onclick="postCrush()" style="white-space: nowrap;">Post Confession</button>
</div>
      
<div id="crushList" class="scrollable-box"></div>
    </div>
  </div>

  <div class="top-reacted">
    <h3>Top Reacted Quotes</h3>
    <ol id="topQuotes"></ol>
  </div>
  
  <div class="minigames">
    <h3>Minigames</h3>

    <div style="text-align:center; background:#fff3e0; padding:20px; border-radius:12px; margin-bottom:20px;">
      <h4>‚òïÔ∏è Coffee Clicker</h4>
      <p>Cups brewed: <span id="coffeeCount">0</span></p>
      <button onclick="brewCoffee()">Brew Coffee</button>
    </div>

    <div style="background:#fff3e0; padding:20px; border-radius:12px;">
  <h4>üß† Coffee Quiz</h4>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
    <span style="font-weight: bold;">‚òï Latte Points: <span id="lattePoints">0</span></span>
    <button onclick="resetLattePoints()" style="background:#d7ccc8; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;">üîÑ Reset</button>
  </div>
  <p id="quizQuestion" style="margin-bottom:10px;"></p>
  <div id="quizOptions" style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom:10px;"></div>
  <p id="quizFeedback" style="margin-bottom:10px;"></p>
  <button onclick="loadRandomCoffeeQuestion()" style="width:100%; background:#a1887f; color:white; border:none; padding:10px; border-radius:6px; cursor:pointer;">‚òï Next Brew</button>
</div>

  </div>

  <div class="meme-generator" style="display: flex; gap: 20px; align-items: flex-start;">
  <canvas id="memeCanvas" width="400" height="400" style="border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1);"></canvas>

  <div style="flex: 1;">
    <h3>Meme Generator</h3>
    <input type="text" id="topText" placeholder="Top text" style="margin-bottom:10px; width:100%;"/>
    <input type="text" id="bottomText" placeholder="Bottom text" style="margin-bottom:10px; width:100%;"/>
    <button onclick="generateMeme()" class="full-width" style="margin-bottom:10px;">Generate Meme</button>
    <button onclick="generateRandomMeme()" style="width:100%;">üé≤ Random Meme</button>
    <button onclick="downloadMeme()" style="width:100%; margin-top:10px;">‚¨áÔ∏è Download Meme</button>

  </div>

</div>

  <div class="section">
  
<div class="column">
  <h3>üñºÔ∏è Meme Gallery (Templates)</h3>
<div id="memeGallery" class="scrollable-box gallery-grid" style="max-height: 300px;"></div>
</div>

<div class="column">
  <h3>üé® Meme Collections (Creations)</h3>
<div id="memeCollections" class="scrollable-box gallery-grid" style="max-height: 300px;"></div>
</div>

    </div>


<div id="galleryModal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header">
      <span id="closeGalleryModal" class="close-button">Back</span>
      <button id="useModalImage" class="use-image-button">Use this image</button>
    </div>
    <img id="galleryModalImage" src="" alt="Meme Preview" />
  </div>
</div>

<div id="collectionModal" class="modal" style="display:none;">
  <div class="modal-content">
    <div class="modal-header" id="collectionModalHeader"></div>
    <img id="collectionModalImage" src="" alt="Generated Meme Preview" />
  </div>

</div> 

<div style="margin-top:30px; background:#fff3e0; padding:20px; border-radius:12px;">
  <h4>üì§ Submit Your Own Meme Template</h4>
  <button onclick="toggleMemeInput()">Switch to File Upload</button>
  <input type="file" id="customFile" style="display:none; margin-top:10px;" />
  <input type="text" id="customUrl" placeholder="Image URL" style="width:100%; margin-bottom:10px;" />
  <input type="text" id="customTop" placeholder="Top text" style="width:100%; margin-bottom:10px;" />
  <input type="text" id="customBottom" placeholder="Bottom text" style="width:100%; margin-bottom:10px;" />
  <button onclick="submitCustomMeme()" style="width:100%;">Add to Meme List</button>
</div>

  <div id="coffeeTriviaModal" style="display:none; position:fixed; top:20px; right:20px; background-color:#ffeaa7; border:1px solid #dfe6e9; padding:10px 20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.2); font-weight:bold; color:#2d3436; font-family:'Segoe UI', sans-serif;">
</div>

  <div id="emojiBurstContainer" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; overflow:hidden;"></div>

  <div id="notification" style="position:fixed;bottom:20px;right:20px;background:#333;color:#fff;padding:10px;border-radius:5px;display:none;z-index:9999;max-width:320px;word-wrap:break-word;box-shadow:0 4px 12px rgba(0,0,0,0.15);"></div>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.1/firebase-database-compat.js"></script>

  
  <script>
    
let selectedMemeURL = null;

    let quoteList = [];
    let crushList = [];
    const reactions = ["‚ù§Ô∏è", "üòÜ", "üò¢", "üòÆ", "üò°"];

    const firebaseConfig = {
  apiKey: "AIzaSyD9B8m_cJ2kXQuwoliL3WAowC-hFgPBjBg",
  authDomain: "student-cozy-corner.firebaseapp.com",
  databaseURL: "https://student-cozy-corner-default-rtdb.asia-southeast1.firebasedatabase.app", 
  storageBucket: "student-cozy-corner.appspot.com",
  messagingSenderId: "436355859247",
  appId: "1:436355859247:web:a98f51fb48219596ad57da"
};


    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

function showNotification(msg, duration = 3000) {
  const n = document.getElementById('notification');
  if (!n) return console.log(msg);
  n.textContent = msg;
  n.style.display = 'block';
  n.style.opacity = '0.95';
  n.style.transform = 'translateY(0)';
  setTimeout(() => { n.style.display = 'none'; n.style.opacity = '0'; }, duration);
}


    

    console.log("Firebase apps:", firebase.apps);
console.log("Firebase app options:", firebase.apps[0] && firebase.apps[0].options);

try { console.log("DB URL:", firebase.apps[0].options.databaseURL); } catch(e){console.warn(e);} 

db.ref(".info/connected").on("value", snap => {
  console.log(".info/connected:", snap.val());
});

function testWrite() {
  const tpath = "debug/testWrites";
  const payload = { ts: Date.now(), source: "site-debug" };
  console.log("Attempting test write to", tpath, payload);
  db.ref(tpath).push(payload)
    .then(() => {
      console.log("Test write successful. Check Firebase console at path:", tpath);
      showNotification("Test write ok ‚Äî check Firebase Realtime Database (/debug/testWrites)");
    })
    .catch(err => {
      console.error("Test write failed:", err);
      showNotification("Test write failed ‚Äî check console for details");

    });
}

function postQuoteDebug() {
  const input = document.getElementById("quoteInput");
  const text = input.value.trim();
  if (!text) { showNotification("‚ö†Ô∏è Please type a quote first"); return; }

  const entry = {
    text,
    reacts: { "‚ù§Ô∏è": 0, "üòÜ": 0, "üò¢": 0, "üòÆ": 0, "üò°": 0 },
    selectedReaction: null,
    timestamp: Date.now()
  };

  console.log("Posting quote to /quotes:", entry);
  db.ref("quotes").push(entry)
    .then(() => {
      console.log("push() resolved ‚Äî quote added");
      showNotification("Quote posted! Refresh Firebase console (Realtime DB) to verify.");
      input.value = "";
    })
    .catch(err => {
      console.error("push() error:", err);
      showNotification("Failed to post quote ‚Äî check console for error (permission/network).");
    });
}

    function postQuote() {
  if (typeof postQuoteDebug === 'function') return postQuoteDebug();
  showNotification("Posting temporarily unavailable.");
}




const postBtn = document.querySelector('[onclick="postQuote()"]');
if (postBtn) postBtn.onclick = postQuoteDebug;

    const randomQuotes = [
  { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
  { text: "Coffee first. Capstone later.", author: "Yonie" },
  { text: "Success is not final, failure is not fatal.", author: "Winston Churchill" },
  { text: "Life happens. Coffee helps.", author: "Anonymous" },
  { text: "I run on caffeine, deadlines, and mild panic.", author: "Yeon" },
  { text: "Reality called. I hit decline.", author: "Unknown" },
  { text: "PAPASA TAYO GAIS", author: "I BILIB" },
  { text: "Behind every tired student is a coffee that tried its best.", author: "Anonymous" },
  { text: "Some days you win. Some days you spill your coffee.", author: "Unknown" },
  { text: "Hanggang san a-abot 20 pesos mo?", author: "Cornetto" },
  { text: "The grind never stops ‚Äî unless the beans run out.", author: "Barista Wisdom" },
  { text: "Gusto ko na matulog.", author: "Yonie" },
  { text: "You can't pour from an empty cup. Refill with coffee first.", author: "Self-Care Society" },
  { text: "Group projects: where your silence is louder than your effort.", author: "Reality Hurts" },
  { text: "Sleep is for the weak. Kape na laman ng dugo ko.", author: "Yeon" },
  { text: "I‚Äôm not procrastinating. I‚Äôm marinating in potential.", author: "Student Logic" },  
  { text: "It always seems impossible until it's done.", author: "Nelson Mandela" },
  { text: "Do not wait for the perfect moment. Take the moment and make it perfect.", author: "Zoey Sayward" },
  { text: "Start where you are. Use what you have. Do what you can.", author: "Arthur Ashe" },
  { text: "Happiness is not something ready made. It comes from your own actions.", author: "Dalai Lama" },
  { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" }
];

    const coffeeQuiz = [
  {
    question: "Which country drinks the most coffee per capita?",
    correct: "Finland",
    options: ["Finland", "Italy", "USA"]
  },
  {
    question: "What does 'espresso' mean in Italian?",
    correct: "Pressed out",
    options: ["Fast", "Strong", "Pressed out"]
  },
  {
    question: "What was the first webcam used to monitor?",
    correct: "A coffee pot",
    options: ["A printer", "A coffee pot", "A vending machine"]
  },
  {
    question: "What fruit does coffee come from?",
    correct: "Cherry",
    options: ["Berry", "Cherry", "Nut"]
  },
  {
    question: "Which famous composer counted 60 beans per cup?",
    correct: "Beethoven",
    options: ["Mozart", "Beethoven", "Bach"]
  },
  {
    question: "What nickname did coffee earn in the Islamic world?",
    correct: "Wine of Islam",
    options: ["Black nectar", "Wine of Islam", "Sufi brew"]
  },
  {
    question: "Which coffee drink is made with equal parts espresso and steamed milk?",
    correct: "Flat white",
    options: ["Latte", "Flat white", "Macchiato"]
  },
  {
    question: "Which coffee bean variety is known for being smoother and less acidic?",
    correct: "Arabica",
    options: ["Robusta", "Arabica", "Liberica"]
  },
  {
    question: "What‚Äôs the ideal brewing temperature for coffee?",
    correct: "90‚Äì96¬∞C",
    options: ["80‚Äì85¬∞C", "90‚Äì96¬∞C", "100¬∞C"]
  },
  {
    question: "Which animal is associated with the discovery of coffee?",
    correct: "Goat",
    options: ["Monkey", "Goat", "Camel"]
  }
];

let lattePoints = 0;
let currentCoffeeQuestion = null;

function loadRandomCoffeeQuestion() {
  const randomIndex = Math.floor(Math.random() * coffeeQuiz.length);
  currentCoffeeQuestion = coffeeQuiz[randomIndex];

  document.getElementById("quizQuestion").textContent = currentCoffeeQuestion.question;

  const optionsContainer = document.getElementById("quizOptions");
  optionsContainer.innerHTML = "";

  currentCoffeeQuestion.options.forEach(option => {
    const btn = document.createElement("button");
    btn.textContent = option;
    btn.onclick = () => checkCoffeeAnswer(option);
    btn.style.padding = "10px 20px";
    btn.style.borderRadius = "6px";
    btn.style.border = "none";
    btn.style.backgroundColor = "#a1887f";
    btn.style.color = "white";
    btn.style.cursor = "pointer";
    optionsContainer.appendChild(btn);
  });

  document.getElementById("quizFeedback").textContent = "";
}

function checkCoffeeAnswer(selected) {
  const correct = currentCoffeeQuestion.correct;
  const feedback = document.getElementById("quizFeedback");

  if (selected === correct) {
    lattePoints++;
    document.getElementById("lattePoints").textContent = lattePoints;
    feedback.textContent = "‚òï Correct! You earned a latte point!";
    feedback.style.color = "#4caf50";
  } else {
    feedback.textContent = "üò¨ Nope! That‚Äôs not the brew-tiful answer.";
    feedback.style.color = "#e53935";
  }
}

function resetLattePoints() {
  lattePoints = 0;
  document.getElementById("lattePoints").textContent = lattePoints;
  document.getElementById("quizFeedback").textContent = "üîÑ Latte Points reset!";
  document.getElementById("quizFeedback").style.color = "#6d4c41";
}
    
function generateRandomQuote() {
  const pick = randomQuotes[Math.floor(Math.random() * randomQuotes.length)];
  document.getElementById("quoteInput").value = `"${pick.text}" ‚Äî ${pick.author}`;
}

    function postCrush() {
      const input = document.getElementById("crushInput");
      const text = input.value.trim();
      const expiry = document.getElementById("confessionExpiry").value;

      if (!text || !expiry) {
	showNotification("‚ö†Ô∏è Please fill in all fields");
        return;
      }

      const timestamp = Date.now();
      const expiresAt = timestamp + parseFloat(expiry) * 60 * 1000;

      const entry = { text, expiresAt, timestamp };

      db.ref("confessions").push(entry).catch(err => console.error("Failed to push confession:", err));
      input.value = "";
      document.getElementById("confessionExpiry").value = "";
    }

    function saveCrushes() {
  localStorage.setItem("studentCrushes", JSON.stringify(crushList));
}

function loadCrushes() {
  const saved = JSON.parse(localStorage.getItem("studentCrushes") || "[]");
  const now = Date.now();
  const valid = saved.filter(c => c.expiresAt > now);
  crushList.length = 0;
  valid.forEach(c => crushList.push(c));
  localStorage.setItem("studentCrushes", JSON.stringify(valid));
}

  function reactToQuote(quoteId, emoji) {
  const reactionRef = db.ref(`quotes/${quoteId}/reacts/${emoji}`);
  reactionRef.transaction(current => (current || 0) + 1);

  document.addEventListener("click", function burstHandler(e) {
    triggerEmojiBurst(emoji, e.clientX, e.clientY);
    document.removeEventListener("click", burstHandler);
  });
}


function renderQuotes() {
      const container = document.getElementById("quoteList");

      db.ref("quotes").on("value", snapshot => {
        container.innerHTML = "";
        quoteList.length = 0;
        snapshot.forEach(child => {
          const q = child.val();
          q._id = child.key;
          quoteList.push(q);

          const quoteId = child.key;
          const selected = q.selectedReaction || null;

          const div = document.createElement("div");
          div.className = "entry";
          div.style.position = "relative";

          div.innerHTML = `<strong>${q.text}</strong>`;

          const circle = document.createElement("div");
          circle.className = "reaction-circle";
          const activeReacts = Object.entries(q.reacts || {})
            .filter(([_, count]) => count > 0)
            .slice(0, 3);
          circle.textContent = activeReacts.map(([r]) => r).join(" ");
          div.appendChild(circle);

          const reactionDiv = document.createElement("div");
          reactionDiv.className = "reactions";
          if (selected) reactionDiv.setAttribute("data-selected", "true");

          reactions.forEach(r => {
            const span = document.createElement("span");
            span.textContent = r;
            if (selected === r) span.setAttribute("data-active", "true");

            span.onclick = (e) => {
              db.ref(`quotes/${quoteId}/selectedReaction`).set(r);
              db.ref(`quotes/${quoteId}/reacts/${r}`).transaction(current => (current || 0) + 1);

              triggerEmojiBurst(r, e.clientX, e.clientY);
            };

            reactionDiv.appendChild(span);
          });

          div.appendChild(reactionDiv);
          container.appendChild(div);
        });

        updateTopQuotes();
      }, err => {
        console.error("Error reading quotes:", err);
      });
    }


function triggerEmojiBurst(emoji, x, y) {
      const burst = document.createElement("div");
      burst.className = "emoji-burst";
      burst.textContent = emoji;
      burst.style.left = `${x}px`;
      burst.style.top = `${y}px`;
      document.getElementById("emojiBurstContainer").appendChild(burst);
      setTimeout(() => burst.remove(), 1000);
    }


    function renderCrushes() {
      const crushListEl = document.getElementById("crushList");
      crushListEl.innerHTML = "";

      db.ref("confessions").on("value", snapshot => {
        crushListEl.innerHTML = "";
        const now = Date.now();

        snapshot.forEach(child => {
          const crush = child.val();
          if (!crush) return;
          if (crush.expiresAt > now) {
            const div = document.createElement("div");
            div.className = "entry";
            div.style.fontStyle = "italic";
            div.textContent = crush.text;
            crushListEl.appendChild(div);
          } else {
          }
        });
      }, err => {
        console.error("Error reading confessions:", err);
      });
    }


    function updateTopQuotes() {
      const sorted = [...quoteList].sort((a, b) => {
        const totalA = Object.values(a.reacts || {}).reduce((sum, val) => sum + (val || 0), 0);
        const totalB = Object.values(b.reacts || {}).reduce((sum, val) => sum + (val || 0), 0);
        return totalB - totalA;
      }).slice(0, 3);

      const list = document.getElementById("topQuotes");
      list.innerHTML = "";
      sorted.forEach(q => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${q.text}</strong>
          <div class="reaction-counts">
            ${Object.entries(q.reacts || {}).map(([r, count]) => `${r} ${count}`).join(" ")}
          </div>
        `;
        list.appendChild(li);
      });
    }


    function brewCoffee() {
      coffeeCount++;
      document.getElementById("coffeeCount").textContent = coffeeCount;
    }

    let coffeeCount = 0;

    function checkAnswer(answer) {
    const correct = "Steve Jobs";
    const feedback = document.getElementById("quizFeedback");
    feedback.textContent = answer === correct ? "Nice! You deserve a latte!" : "Oops, Try again!";
  }

  const memeImages = [
  {
    url: "https://i.imgflip.com/1bij.jpg",
    top: "Me trying to focus",
    bottom: "But coffee exists ‚òï"
  },
  {
    url: "https://i.imgflip.com/26am.jpg",
    top: "Mondays?",
    bottom: "No thanks."
  },
  {
    url: "https://i.imgflip.com/3si4.jpg",
    top: "One does not simply",
    bottom: "Finish a group project without memes"
  },
  {
    url: "https://i.imgflip.com/30b1gx.jpg",
    top: "You should sleep early",
    bottom: "mE: 'sLeEp EaRlY'"
  },
  {
    url: "https://i.imgflip.com/1otk96.jpg",
    top: "Can't fail the quiz",
    bottom: "If you never take it"
  },
  {
    url: "https://i.imgflip.com/2wifvo.jpg",
    top: "Groupmate: I did my part",
    bottom: "Reality: üòº"
  },
  {
    url: "https://i.imgflip.com/4t0m5.jpg",
    top: "To surviving finals",
    bottom: "With caffeine and chaos"
  },
  {
    url: "https://i.imgflip.com/1g8my4.jpg",
    top: "Trying to understand",
    bottom: "JavaScript logic"
  },
  {
    url: "https://i.imgflip.com/1ur9b0.jpg",
    top: "Doing homework",
    bottom: "Making memes instead"
  }
];


function generateMeme() {
  const canvas = document.getElementById("memeCanvas");
  const ctx = canvas.getContext("2d");
  const topText = document.getElementById("topText").value;
  const bottomText = document.getElementById("bottomText").value;

  const memeImg = new Image();
  memeImg.crossOrigin = "anonymous";
  memeImg.src = selectedMemeURL || memeImages[Math.floor(Math.random() * memeImages.length)].url;

  memeImg.onload = function () {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(memeImg, 0, 0, canvas.width, canvas.height);
  ctx.font = "bold 24px Arial";
  ctx.fillStyle = "white";
  ctx.strokeStyle = "black";
  ctx.lineWidth = 2;
  ctx.textAlign = "center";
  ctx.fillText(topText, canvas.width / 2, 40);
  ctx.strokeText(topText, canvas.width / 2, 40);
  ctx.fillText(bottomText, canvas.width / 2, canvas.height - 20);
  ctx.strokeText(bottomText, canvas.width / 2, canvas.height - 20);


  const fullImg = canvas.toDataURL("image/png"); 

const canvasCopy = document.createElement("canvas");
canvasCopy.width = 120;
canvasCopy.height = 120;
const ctxCopy = canvasCopy.getContext("2d");
ctxCopy.drawImage(canvas, 0, 0, 120, 120);
const thumbImg = canvasCopy.toDataURL("image/png");

setTimeout(() => {
  const saved = JSON.parse(localStorage.getItem("generatedMemes") || "[]");
  saved.push({ thumb: thumbImg, full: fullImg });
  localStorage.setItem("generatedMemes", JSON.stringify(saved));
  renderMemeCollections();
}, 100);

};
}

function generateRandomMeme() {
  selectedMemeURL = null;
  const randomIndex = Math.floor(Math.random() * memeImages.length);
  document.getElementById("topText").value = memeImages[randomIndex].top;
  document.getElementById("bottomText").value = memeImages[randomIndex].bottom;
  generateMeme();
}

    const coffeeTrivia = [
  "ü¶∑‚òï Coffee was originally chewed, not sipped! Early tribes ground the beans and mixed them with fat to make energy bites.",
  "üîßü´ò Espresso means 'pressed out' in Italian ‚Äî it‚Äôs all about brewing under pressure, not the bean itself.",
  "üìπ‚òï The first webcam was invented to monitor a coffee pot at Cambridge University. No one wanted to walk across the hall for an empty pot!",
  "üåçüïå The word 'coffee' comes from the Arabic 'qahwa', which originally referred to wine ‚Äî poetic and energizing.",
  "üçíüå± Coffee is technically a fruit! The beans we brew are seeds from a cherry-like fruit that grows on coffee trees.",
  "üò¥‚ö° Decaf doesn‚Äôt mean caffeine-free ‚Äî it still contains 1‚Äì2% caffeine. Enough to keep your eyelids twitching during finals.",
  "ü´ò‚òï Finland drinks the most coffee per capita in the world ‚Äî averaging four cups a day. Cozy culture goals!",
  "üìúüö´ Coffee was almost lost to history ‚Äî banned in Mecca in the 1500s for 'stimulating radical thinking.' Luckily, the ban didn‚Äôt stick.",
  "üíß‚òï Contrary to myth, coffee won‚Äôt dehydrate you. It‚Äôs mostly water, and moderate sipping actually helps hydration.",
  "ü´òüí® Espresso isn‚Äôt a type of bean ‚Äî it‚Äôs a brewing method. Any bean can be espresso if brewed with pressure.",
  "üêêüíÉ Legend says goats discovered coffee ‚Äî a herder saw them dancing after eating coffee cherries. The original caffeine party.",
  "üéº‚òï Beethoven was a coffee snob ‚Äî he counted exactly 60 beans per cup before brewing. Precision brewing, classical edition.",
  "üç∑üïäÔ∏è Coffee was once called the 'wine of Islam' ‚Äî praised for its energizing effects and used in spiritual rituals before going global.",
  "wAlA pArin aKonG tUlOg hiHihiEüíï‚ú®",
];

function showCoffeeTrivia() {
  const modal = document.getElementById("coffeeTriviaModal");
  const random = Math.floor(Math.random() * coffeeTrivia.length);
  modal.textContent = coffeeTrivia[random];
  modal.style.display = "block";
  setTimeout(() => {
    modal.style.display = "none";
  }, 4000);
}


let reminderEnabled = true;
let reminderMode = 'coffeeTrivia'; // 'coffeeTrivia' or 'relax'
let reminderTimeoutId = null;
let reminderIntervalId = null;

function showReminder() {
  const modal = document.getElementById("coffeeTriviaModal");
  modal.textContent = "Relax and ChillüçÉ‚ú®";
  modal.style.display = "block";
  setTimeout(() => {
    modal.style.display = "none";
  }, 3000);
}

function startReminderScheduler() {
  stopReminderScheduler();
  if (!reminderEnabled) return;
  const initialDelay = 3000;
  if (reminderMode === 'coffeeTrivia') {
    reminderTimeoutId = setTimeout(() => {
      showCoffeeTrivia();
      reminderIntervalId = setInterval(showCoffeeTrivia, 7000);
    }, initialDelay);
  } else {
    reminderTimeoutId = setTimeout(() => {
      showReminder();
      reminderIntervalId = setInterval(showReminder, 5000);
    }, initialDelay);
  }
}

function stopReminderScheduler() {
  if (reminderTimeoutId) { clearTimeout(reminderTimeoutId); reminderTimeoutId = null; }
  if (reminderIntervalId) { clearInterval(reminderIntervalId); reminderIntervalId = null; }
  const modal = document.getElementById("coffeeTriviaModal");
  if (modal) modal.style.display = "none";
}

function toggleReminderEnabled(enabled) {
  reminderEnabled = enabled;
  if (enabled) startReminderScheduler(); else stopReminderScheduler();
}

function setReminderMode(mode) {
  reminderMode = mode;
  if (reminderEnabled) startReminderScheduler();
  showNotification('Reminder mode: ' + (mode === 'coffeeTrivia' ? 'Coffee Trivia' : 'Relax & Chill'));
}

function createReminderToggle() {
  if (document.getElementById('reminderToggle')) return; 

  const btn = document.createElement('button');
  btn.id = 'reminderToggle';
  btn.style.position = 'fixed';
  btn.style.top = '110px';
  btn.style.right = '16px';
  btn.style.zIndex = '9999';
  btn.style.background = '#a1887f';   
  btn.style.color = 'white';
  btn.style.border = 'none';
  btn.style.width = '42px';
  btn.style.height = '42px';
  btn.style.borderRadius = '50%';
  btn.style.cursor = 'pointer';
  btn.style.fontSize = '20px';
  btn.style.display = 'flex';
  btn.style.alignItems = 'center';
  btn.style.justifyContent = 'center';
  btn.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
  btn.textContent = reminderEnabled ? 'üîî' : 'üîï';

  btn.title = reminderEnabled
    ? (reminderMode === 'coffeeTrivia' ? 'Coffee Trivia (enabled)' : 'Relax & Chill (enabled)')
    : 'Reminders Off';

  btn.onclick = () => {
    reminderEnabled = !reminderEnabled;
    if (reminderEnabled) startReminderScheduler(); else stopReminderScheduler();
    btn.textContent = reminderEnabled ? 'üîî' : 'üîï';
    btn.title = reminderEnabled
      ? (reminderMode === 'coffeeTrivia' ? 'Coffee Trivia (enabled)' : 'Relax & Chill (enabled)')
      : 'Reminders Off';
    showNotification(btn.title, 1500);
  };

  btn.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    reminderMode = (reminderMode === 'coffeeTrivia') ? 'relax' : 'coffeeTrivia';
    if (reminderEnabled) startReminderScheduler();
    btn.title = reminderEnabled
      ? (reminderMode === 'coffeeTrivia' ? 'Coffee Trivia (enabled)' : 'Relax & Chill (enabled)')
      : 'Reminders Off';
    showNotification('Reminder mode: ' + (reminderMode === 'coffeeTrivia' ? 'Coffee Trivia' : 'Relax & Chill'), 1800);
    return false;
  });

  btn.addEventListener('mouseenter', () => {
    showNotification(btn.title, 1200);
  });

  document.body.appendChild(btn);
}

createReminderToggle();
startReminderScheduler();


    
function downloadMeme() {
  const canvas = document.getElementById("memeCanvas");
  const link = document.createElement("a");
  link.download = "student-meme.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}
function submitCustomMeme() {
  const urlInput = document.getElementById("customUrl");
  const fileInput = document.getElementById("customFile");
  const top = document.getElementById("customTop").value.trim();
  const bottom = document.getElementById("customBottom").value.trim();

  const isFileMode = fileInput.style.display !== "none";

  if (top && bottom && (isFileMode ? fileInput.files.length > 0 : urlInput.value.trim())) {
    let memeURL = "";

    if (isFileMode) {
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function (e) {
        memeURL = e.target.result;
        saveCustomMeme(memeURL, top, bottom);
      };
      reader.readAsDataURL(file);
    } else {
      memeURL = urlInput.value.trim();
      saveCustomMeme(memeURL, top, bottom);
    }
  } else {
    showNotification("Meme added!");
  }
}
function saveCustomMeme(url, top, bottom) {
  const newMeme = { url, top, bottom };
  memeImages.push(newMeme);

  const savedMemes = JSON.parse(localStorage.getItem("studentMemes") || "[]");
  savedMemes.push(newMeme);
  localStorage.setItem("studentMemes", JSON.stringify(savedMemes));

  showNotification("Meme added!");
  document.getElementById("customUrl").value = "";
  document.getElementById("customTop").value = "";
  document.getElementById("customBottom").value = "";
  document.getElementById("customFile").value = "";

  renderMemeGallery();
}

    function renderMemeGallery() {
  const gallery = document.getElementById("memeGallery");
  gallery.innerHTML = "";
  memeImages.forEach(meme => {
    const img = new Image();
    img.src = meme.url;
    img.alt = "Meme Template";
    img.title = `${meme.top} / ${meme.bottom}`;
    img.onclick = () => openGalleryModal(meme.url);
    gallery.appendChild(img);
  });
}
    function openGalleryModal(src) {
  document.getElementById("galleryModalImage").src = src;
  document.getElementById("galleryModal").style.display = "flex";

  document.getElementById("useModalImage").onclick = () => {
    selectedMemeURL = src;
    document.getElementById("galleryModal").style.display = "none";
    generateMeme();
  };

  document.getElementById("closeGalleryModal").onclick = () => {
    document.getElementById("galleryModal").style.display = "none";
  };

  setTimeout(() => {
    document.getElementById("galleryModal").scrollIntoView({ behavior: "smooth", block: "center" });
  }, 100);
}

    function renderMemeCollections() {
  const gallery = document.getElementById("memeCollections");
  gallery.innerHTML = "";

  const saved = JSON.parse(localStorage.getItem("generatedMemes") || "[]");

  saved.forEach(item => {
  const img = new Image();
  img.src = item.thumb;   
  img.alt = "Generated Meme";
  img.style.width = "120px";
  img.style.height = "120px";
  img.style.objectFit = "cover";
  img.style.borderRadius = "8px";
  img.style.margin = "5px";
  img.style.cursor = "pointer";

  img.onclick = () => openCollectionModal(item.full); 
  gallery.appendChild(img);
});

}

    function openCollectionModal(src) {
  document.getElementById("collectionModalImage").src = src;
  document.getElementById("collectionModal").style.display = "flex";

  const header = document.getElementById("collectionModalHeader");
  header.innerHTML = "";

  const backBtn = document.createElement("span");
  backBtn.className = "close-button";
  backBtn.textContent = "Back";
  backBtn.onclick = () => {
    document.getElementById("collectionModal").style.display = "none";
  };

  const deleteBtn = document.createElement("button");
deleteBtn.textContent = "Remove";
deleteBtn.className = "use-image-button";
deleteBtn.style.marginLeft = "10px";
deleteBtn.onclick = () => {
  const saved = JSON.parse(localStorage.getItem("generatedMemes") || "[]");
  const updated = saved.filter(item => item.full !== src);
  localStorage.setItem("generatedMemes", JSON.stringify(updated));
  document.getElementById("collectionModal").style.display = "none";
  renderMemeCollections();
  showNotification("Meme removed from collection");
};


  header.appendChild(backBtn);
  header.appendChild(deleteBtn);

  setTimeout(() => {
    document.getElementById("collectionModal").scrollIntoView({ behavior: "smooth", block: "center" });
  }, 100);
}
    
    function toggleMemeInput() {
  const urlInput = document.getElementById("customUrl");
  const fileInput = document.getElementById("customFile");
  const toggleBtn = document.querySelector('[onclick="toggleMemeInput()"]');

  const isUrlMode = urlInput.style.display !== "none";

  if (isUrlMode) {
    urlInput.style.display = "none";
    fileInput.style.display = "block";
    toggleBtn.textContent = "Switch to Image URL";
  } else {
    urlInput.style.display = "block";
    fileInput.style.display = "none";
    toggleBtn.textContent = "Switch to File Upload";
  }
}

function memeCollections() {
  localStorage.setItem("generatedMemes", JSON.stringify([]));
  renderMemeCollections();
  showNotification("Meme collection cleared!");
}


    function saveQuotes() {
  localStorage.setItem("studentQuotes", JSON.stringify(quoteList));
}

function loadQuotes() {
  const saved = JSON.parse(localStorage.getItem("studentQuotes") || "[]");
  quoteList.length = 0; 
  saved.forEach(q => quoteList.push(q));
}

window.onload = function () {
      renderQuotes();
      renderCrushes();

      renderMemeGallery && renderMemeGallery();
      renderMemeCollections && renderMemeCollections();
      loadCrushes && loadCrushes(); 
    };

  </script>
</body>
</html>
